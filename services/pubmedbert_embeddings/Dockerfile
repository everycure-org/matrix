ARG BASE_IMAGE=python:3.11-slim
FROM $BASE_IMAGE AS build
COPY --from=ghcr.io/astral-sh/uv:latest /uv /bin/uv

WORKDIR /app
ADD requirements.txt .

RUN uv venv && \
    uv pip install -r requirements.txt
ENV PATH=/app/.venv/bin:$PATH
# Download and cache the model
RUN python -c "from transformers import AutoTokenizer, AutoModel; \
    model_name='microsoft/BiomedNLP-PubMedBERT-base-uncased-abstract-fulltext'; \
    AutoTokenizer.from_pretrained(model_name); \
    AutoModel.from_pretrained(model_name)"

ADD . .


CMD "python" "app.py"