name: Push Image

on:
  workflow_call:

jobs:
  push_image:

    runs-on: "self-hosted"
    environment: dev
    permissions: write-all
    defaults:
      run:
        working-directory: ./pipelines/matrix

    steps:

      - uses: 'google-github-actions/auth@v2'
        with:
          project_id: ${{vars.project_id}}
          workload_identity_provider: ${{vars.workload_identity_provider}}
          service_account: ${{vars.service_account}}

      - name: "Set up Cloud SDK"
        uses: "google-github-actions/setup-gcloud@v1"

      - name: "Docker auth"
        run: |-
          gcloud auth configure-docker ${{ vars.region }}-docker.pkg.dev --quiet

      - run: make docker_push
