#   2nd workflow (gets triggered once PR is approved)
#   0. figure out tag from most recent folder in docs/src/releases/posts
#   1. gh release create <TAG FROM ABOVE> -F docs/src/releases/posts/.../post.md (edited)
#   2. How do we automate writing the article? Slack notifications?

name: Release
on:
  push:
    branches:
      - 'feat/trigger-release-from-gh-action'
      
  pull_request:
    types: [closed]

jobs:
  # approved:
  #   if: github.event.pull_request.merged == true && contains(github.event.pull_request.labels.*.name, 'Release')
  #   runs-on: ubuntu-latest
  #   name: PR approval
  #   permissions:
  #     pull-requests: 'read'

  #   steps:
  #     - name: "Check the PR state"
  #       run: echo "The release PR was approved"

  create_release:
    # needs: [approved]
    runs-on: ubuntu-latest
    name: Create release

    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-tags: true
          fetch-depth: 0

      - name: Fetch latest tag
        id: fetch_latest_tag
        run: |
          latest_tag=$(git tag --list --sort="v:refname" | tail -n 1)
          echo "latest_tag=${latest_tag}" >> "$GITHUB_ENV"
          echo "Latest tag is ${latest_tag}"

      - name: Create GitHub release
        env:
          latest_tag: ${{ steps.fetch_latest_tag.outputs.latest_tag }}
        run: |
          echo "Latest tag is $latest_tag"
          # echo "Creating release"
          # gh release create "${{ env.latest_tag }}" \
          #   -F "${{ github.workspace }}/docs/src/releases/posts/${{ env.latest_tag }}/notes.md" \
          #   -t "${{ env.latest_tag }}" \
          #   --draft \
          #   --latest
