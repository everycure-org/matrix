_layer_raw: &_layer_raw
  metadata:
    kedro-viz:
      layer: raw

_layer_int: &_layer_int
  metadata:
    kedro-viz:
      layer: integration

_layer_prm: &_layer_prm
  metadata:
    kedro-viz:
      layer: primary

###################################
########### INPUT DATA ############
###################################

disease_mondo.raw.mondo_graph:
  type: core_entities.datasets.rdf.PyOxiGraphDataset
  <<: *_layer_raw
  filepath: http://purl.obolibrary.org/obo/mondo.owl
  load_args:
    format: xml

disease_mondo.raw.mondo_sssom:
  type: pandas.CSVDataset
  <<: *_layer_raw
  filepath: http://purl.obolibrary.org/obo/mondo/mappings/mondo.sssom.tsv
  load_args:
    sep: "\t"
    comment: "#"

# TODO There is a disconnected subpipeline generating this file:
# https://github.com/everycure-org/matrix-disease-list/blob/main/llm-disease-categorization
# Consider integrating that into this pipeline or deprecating it
disease_mondo.raw.disease_list_llm_tags:
  type: pandas.CSVDataset
  <<: *_layer_raw
  filepath: https://raw.githubusercontent.com/everycure-org/matrix-disease-list/refs/heads/main/llm-disease-categorization/data/03_primary/disease_categories.tsv
  load_args:
    sep: "\t"

disease_mondo.raw.mondo_obsoletion_candidates:
  type: pandas.CSVDataset
  <<: *_layer_raw
  filepath: https://raw.githubusercontent.com/monarch-initiative/mondo/refs/heads/master/src/ontology/reports/mondo_obsoletioncandidates.tsv
  load_args:
    sep: "\t"

disease_mondo.raw.icd10_cm_codes:
  type: pandas.ExcelDataset
  <<: *_layer_raw
  filepath: https://www.cms.gov/files/document/valid-icd-10-list.xlsx
  load_args:
    sheet_name: 0

#############################################
########### Intermediate Outputs ############
#############################################

disease_mondo.int.mondo_preprocessed:
  type: core_entities.datasets.rdf.PyOxiGraphDataset
  <<: *_layer_int
  filepath: ${globals:paths.primary}/disease_mondo/mondo_preprocessed.owl
  save_args:
    format: xml

disease_mondo.int.billable_icd10_codes:
  type: pandas.ParquetDataset
  <<: *_layer_int
  filepath: ${globals:paths.primary}/disease_mondo/icd10_cm_billable.parquet

disease_mondo.int.subtype_counts:
  type: pandas.ParquetDataset
  <<: *_layer_int
  filepath: ${globals:paths.primary}/disease_mondo/subtype_counts.parquet

disease_mondo.int.mondo_metrics:
  type: pandas.ParquetDataset
  <<: *_layer_int
  filepath: ${globals:paths.primary}/disease_mondo/mondo_metrics.parquet

disease_mondo.int.disease_list_raw:
  type: pandas.ParquetDataset
  <<: *_layer_int
  filepath: ${globals:paths.primary}/disease_mondo/disease_list_raw.parquet

#############################################
########### Final Outputs ###################
#############################################

# The final disease list
disease_mondo.prm.disease_list:
  type: pandas.ParquetDataset
  <<: *_layer_prm
  filepath: ${globals:paths.release}/disease_mondo.parquet

# A file containing basic metadata about the disease list run, in particular
# which MONDO version was used to generate the disease list
disease_mondo.prm.mondo_metadata:
  type: pandas.ParquetDataset
  <<: *_layer_prm
  filepath: ${globals:paths.release}/mondo-metadata.parquet

# A full list of all obsoleted MONDO terms, along with their obsoletion reason 
# and replacement term (if any)
disease_mondo.prm.mondo_obsoletes: 
  type: pandas.ParquetDataset
  <<: *_layer_prm
  filepath: ${globals:paths.release}/mondo-obsoletes.parquet

# Obsoletion candidates are diseases that are marked for obsoletion in MONDO
# These are needed so we can define a strategy on how to curate them in our d2d reviews
disease_mondo.prm.mondo_obsoletion_candidates:
  type: pandas.ParquetDataset
  <<: *_layer_prm
  filepath: ${globals:paths.release}/mondo-obsoletion_candidates.parquet
