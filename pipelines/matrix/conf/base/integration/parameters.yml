integration:

  sources:
    rtx_kg2:
      transformer:
        _object: matrix.pipelines.integration.transformers.rtxkg2.RTXTransformer
    # spoke:
    #   transformer:
    #     object: matrix.pipelines.integration.transformers.spoke.SpokeTransformer
    # robokop:
    #   transformer:
    #     object: matrix.pipelines.integration.transformers.robokop.RobokopTransformer
    ec_medical_team:
      transformer:
        _object: matrix.pipelines.integration.transformers.medical.MedicalTransformer
    ec_clinical_trails: 
      transformer:
        _object: matrix.pipelines.integration.transformers.clinical_trails.ClinicalTrialsTransformer
    drug_list: 
      transformer:
        _object: matrix.pipelines.integration.transformers.drugs.DrugsTransformer
    disease_list: 
      transformer:
        _object: matrix.pipelines.integration.transformers.diseases.DiseasesTransformer
    ground_truth: 
      transformer:
        _object: matrix.pipelines.integration.transformers.ground_truth.GroundTruthTransformer
    
  # FUTURE: Ensure we can move this to filters down here
  preprocessing:
    rtx:
      semmed_filters:
        publication_threshold: 10
        ngd_threshold: 0.6
        limit_pmids: 50_000_000 # essentially unlimited, but allows for local clipping if local run is desired

  normalization:
    batch_size: 1000
    normalizer:
      _object: matrix.pipelines.integration.normalizers.ncats.NCATSNodeNormalizer
      endpoint: ${oc.env:NODENORM_ENDPOINT, https://nodenorm.transltr.io/1.5/get_normalized_nodes}
      conflate: true
      drug_chemical_conflate: true
      description: false

  deduplication:
    # choose if a node should have the most specific category. 
    # E.g. if a node has all_categories [biolink:ChemicalEntity, biolink:NamedThing],
    # then node will be assigned biolink:ChemicalEntity as most specific category.
    # For RTX-KG2 reproduction from KGML-xDTD, choose false
    retrieve_most_specific_category: false

  filtering:
    node_filters:
      filter_node_labels:
        _object: matrix.pipelines.modelling.utils.partial_
        func:
          _object: matrix.pipelines.integration.filters.remove_rows_containing_category
        exclude_sources: ["ec_medical"]
        column: category
        categories:
        # TODO: We should likely not remove these before our data release stage but afterwards in the modelling pipeline (if the model so desires)
          - biolink:Activity
          - biolink:Agent
          - biolink:ClinicalIntervention
          - biolink:Cohort
          - biolink:Device
          - biolink:EnvironmentalFeature
          - biolink:EnvironmentalProcess
          - biolink:Event
          - biolink:GeographicLocation
          - biolink:IndividualOrganism
          - biolink:InformationContentEntity
          - biolink:InformationResource
          - biolink:LifeStage
          - biolink:MaterialSample
          - biolink:NamedThing
          - biolink:Phenomenon
          - biolink:PhysicalEntity
          - biolink:PopulationOfIndividualOrganisms
          - biolink:Procedure
          - biolink:Publication
          - biolink:Treatment
          # If you add anything here make sure the fabricator is not generating it, else we remove it
    edge_filters:
      # FUTURE: Ensure the semmed filter is moved here instead
      filter_biolink_edges:
        _object: matrix.pipelines.modelling.utils.partial_
        func:
          _object: matrix.pipelines.integration.filters.biolink_deduplicate_edges