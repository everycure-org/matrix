_layer_raw: &_layer_raw
  metadata:
    kedro-viz:
      layer: raw

_layer_int: &_layer_int
  metadata:
    kedro-viz:
      layer: integration

_layer_prm: &_layer_prm
  metadata:
    kedro-viz:
      layer: primary

_medical_kg_sheets_dataset: &_medical_kg_sheets_dataset
  type: matrix.datasets.gcp.GoogleSheetsDataset
  key: 1LMtOmA10t7a3lcKeTP7zmptOPIcCBIPFVJt9J7jZ2bQ
  service_file: conf/local/service-account.json

_medical_clinical_trials_sheet_dataset: &_medical_clinical_trials_sheet_dataset
  type: matrix.datasets.gcp.GoogleSheetsDataset
  key: 1Wlrjr8ojUGCfWJg-QF5PzpJFqpD7LLH7b60u2XAngh0
  service_file: conf/local/service-account.json

# -------------------------------------------------------------------------
# Datasets
# -------------------------------------------------------------------------

preprocessing.raw.nodes:
  <<: [*_layer_raw, *_medical_kg_sheets_dataset]
  load_args:
    sheet_name: new_nodes
    columns: ["ID", "name", "category", "new_id", "description"]

preprocessing.int.nodes:
  <<: [*_layer_int, *_medical_kg_sheets_dataset]
  save_args:
    sheet_name: new_nodes
    write_columns: ["curie", "normalized_curie", "label", "types"]

  load_args:
    sheet_name: new_nodes
    columns: ["ID", "category", "normalized_curie", "label", "types", "description"]

preprocessing.raw.edges:
  <<: [*_layer_raw, *_medical_kg_sheets_dataset]
  load_args:
    sheet_name: new_edges
    columns: ["Source", "Target", "Label"]

preprocessing.int.edges:
  <<: [*_layer_prm, *_medical_kg_sheets_dataset]
  save_args:
    sheet_name: new_edges
    write_columns: ["SourceId", "TargetId", "Included"]
  load_args:
    sheet_name: new_edges
    columns: ["SourceId", "TargetId", "Label"]

preprocessing.raw.clinical_trials_data:
  <<: *_medical_clinical_trials_sheet_dataset
  load_args:
    sheet_name: new_clinical_trial_DD_pairs
    columns:
      - "clinical_trial_id"
      - "reason_for_rejection"
      - "drug_name"
      - "disease_name"
      - "significantly_better"
      - "non_significantly_better"
      - "non_significantly_worse"
      - "significantly_worse"

preprocessing.int.mapped_clinical_trials_data:
  <<: *_medical_clinical_trials_sheet_dataset
  save_args:
    sheet_name: new_clinical_trial_DD_pairs
    write_columns: ["drug_curie", "disease_curie", "conflict"]
  load_args:
    sheet_name: new_clinical_trial_DD_pairs
    columns:
      - "clinical_trial_id"
      - "reason_for_rejection"
      - "drug_name"
      - "disease_name"
      - "significantly_better"
      - "non_significantly_better"
      - "non_significantly_worse"
      - "significantly_worse"
      - "drug_curie"
      - "disease_curie"
      - "conflict"

preprocessing.raw.disease_list: 
  <<: [*_layer_raw]
  type: pandas.CSVDataset
  filepath: https://api.github.com/repos/everycure-org/matrix-disease-list/releases/assets/${globals:data_sources.ec-disease-list.version}
  fs_args:
    Accept: application/octet-stream
    Authorization: token ${globals:gh_token}
  load_args:
    sep: "\t"

preprocessing.raw.drug_list:
  <<: [*_layer_raw]
  type: pandas.CSVDataset
  # NOTE: This is currently being downloaded through the assets as the repository is private.
  filepath: https://api.github.com/repos/everycure-org/matrix-drug-list/releases/assets/${globals:data_sources.ec-drug-list.version}
  fs_args:
    Accept: application/octet-stream
    Authorization: token ${globals:gh_token}
  load_args:
    sep: "\t"

preprocessing.raw.kgml_xdt_ground_truth.positives:
  <<: [*_layer_raw]
  type: pandas.CSVDataset
  filepath: ${globals:paths.kg_raw}/ground_truth/kg2/${globals:data_sources.kgml-xdtd-gt.version}/tp_pairs.txt
  load_args:
    sep: "\t"
  save_args:
    sep: "\t"

preprocessing.raw.kgml_xdt_ground_truth.negatives:
  <<: [*_layer_raw]
  type: pandas.CSVDataset
  filepath: ${globals:paths.kg_raw}/ground_truth/kg2/${globals:data_sources.kgml-xdtd-gt.version}/tn_pairs.txt
  load_args:
    sep: "\t"
  save_args:
    sep: "\t"

preprocessing.int.kgml_xdt_ground_truth.combined:
  <<: [*_layer_raw]
  type: pandas.CSVDataset
  filepath: ${globals:paths.kg_raw}/ground_truth/kg2/${globals:data_sources.kgml-xdtd-gt.version}/gt_pairs.txt
  load_args:
    sep: "\t"
  save_args:
    sep: "\t"

preprocessing.int.kgml_xdtd_ground_truth.nodes@pandas:
  <<: [*_layer_raw]
  type: pandas.CSVDataset
  filepath: ${globals:paths.tmp}/ground_truth/kg2/${globals:data_sources.kgml-xdtd-gt.version}/nodes.tsv
  load_args:
    sep: "\t"
  save_args:
    sep: "\t"

preprocessing.int.kgml_xdtd_ground_truth.edges@pandas:
  <<: [*_layer_raw]
  type: pandas.CSVDataset
  filepath: ${globals:paths.tmp}/ground_truth/kg2/${globals:data_sources.kgml-xdtd-gt.version}/edges.tsv
  load_args:
    sep: "\t"
  save_args:
    sep: "\t"

preprocessing.int.ec_ground_truth.combined:
  <<: [*_layer_raw]
  type: pandas.CSVDataset
  filepath: ${globals:paths.kg_raw}/ground_truth/kg2/${globals:data_sources.ec-gt.version}/gt_pairs.txt
  load_args:
    sep: "\t"
  save_args:
    sep: "\t"

preprocessing.int.ec_ground_truth.nodes@pandas:
  <<: [*_layer_raw]
  type: pandas.CSVDataset
  filepath: ${globals:paths.tmp}/ground_truth/kg2/${globals:data_sources.ec-gt.version}/nodes.tsv
  load_args:
    sep: "\t"
  save_args:
    sep: "\t"

preprocessing.int.ec_ground_truth.edges@pandas:
  <<: [*_layer_raw]
  type: pandas.CSVDataset
  filepath: ${globals:paths.tmp}/ground_truth/kg2/${globals:data_sources.ec-gt.version}/edges.tsv
  load_args:
    sep: "\t"
  save_args:
    sep: "\t"