_layer_raw: &_layer_raw
  metadata:
    kedro-viz:
      layer: raw

_layer_int: &_layer_int
  metadata:
    kedro-viz:
      layer: integration

_layer_prm: &_layer_prm
  metadata:
    kedro-viz:
      layer: primary

_medical_clinical_trials_sheet_dataset: &_medical_clinical_trials_sheet_dataset
  type: matrix.datasets.gcp.GoogleSheetsDataset
  key: 1Wlrjr8ojUGCfWJg-QF5PzpJFqpD7LLH7b60u2XAngh0
  service_file: conf/local/service-account.json

_medical_kg_sheets_dataset: &_medical_kg_sheets_dataset
  type: matrix.datasets.gcp.GoogleSheetsDataset
  key: 1LMtOmA10t7a3lcKeTP7zmptOPIcCBIPFVJt9J7jZ2bQ
  service_file: conf/local/service-account.json

_spark_parquet_ds: &_spark_parquet
  type: matrix.datasets.gcp.LazySparkDataset
  file_format: parquet
  save_args:
    mode: overwrite

_pandas_parquet_ds: &_pandas_parquet
  type: matrix.datasets.graph.PandasParquetDataset
  save_args:
    engine: pyarrow
  load_args:
    engine: pyarrow

# -------------------------------------------------------------------------
# Datasets
# -------------------------------------------------------------------------
preprocessing.raw.embiology.attr:
  type: pandas.CSVDataset
  filepath: ${globals:paths.kg_raw_private}/embiology/csv/attr.csv.gz

# NOTE: references.csv.gz is a very large dataframe which cant be easily loaded into memory
# so only load columns that are needed.
preprocessing.raw.embiology.ref_pub:
  type: pandas.CSVDataset
  filepath: ${globals:paths.kg_raw_private}/embiology/csv/reference.csv.gz
  load_args:
    nrows: 10000000
    usecols:
      - "id"
      - "unique_ref"
      - "pmid"
      - "doi"

preprocessing.int.embiology.attributes:
  <<: *_spark_parquet
  filepath: ${globals:paths.tmp}/embiology/int/edge_attributes

preprocessing.int.embiology.attr@pandas:
  <<: *_pandas_parquet
  filepath: ${globals:paths.tmp}/embiology/raw/attr

preprocessing.int.embiology.attr@spark:
  <<: *_spark_parquet
  filepath: ${globals:paths.tmp}/embiology/raw/attr

preprocessing.int.embiology.ref_pub@pandas:
  <<: *_pandas_parquet
  filepath: ${globals:paths.tmp}/embiology/raw/ref_pub

preprocessing.int.embiology.ref_pub@spark:
  <<: *_spark_parquet
  filepath: ${globals:paths.tmp}/embiology/raw/ref_pub

preprocessing.raw.embiology.nodes:
  type: pandas.CSVDataset
  filepath: ${globals:paths.kg_raw_private}/embiology/csv/node.csv.gz

preprocessing.int.embiology.nodes@pandas:
  <<: *_pandas_parquet
  filepath: ${globals:paths.tmp}/embiology/raw/nodes

preprocessing.int.embiology.nodes@spark:
  <<: *_spark_parquet
  filepath: ${globals:paths.tmp}/embiology/raw/nodes

preprocessing.prm.embiology.nodes:
  <<: *_spark_parquet
  filepath: ${globals:paths.tmp}/embiology/prm/nodes

preprocessing.prm.embiology.edges:
  <<: *_spark_parquet
  filepath: ${globals:paths.tmp}/embiology/prm/edges

preprocessing.raw.embiology.edges:
  type: pandas.CSVDataset
  filepath: ${globals:paths.kg_raw_private}/embiology/csv/control.csv.gz

preprocessing.int.embiology.edges@pandas:
  <<: *_pandas_parquet
  filepath: ${globals:paths.tmp}/embiology/raw/edges

preprocessing.int.embiology.edges@spark:
  <<: *_spark_parquet
  filepath: ${globals:paths.tmp}/embiology/raw/edges

preprocessing.int.embiology.identifiers@pandas:
  <<: *_pandas_parquet
  filepath: ${globals:paths.tmp}/embiology/int/identifiers

preprocessing.int.embiology.identifiers@spark:
  <<: *_spark_parquet
  filepath: ${globals:paths.tmp}/embiology/int/identifiers

preprocessing.raw.clinical_trials_data:
  <<: *_medical_clinical_trials_sheet_dataset
  load_args:
    sheet_name: new_clinical_trial_DD_pairs
    columns:
      - "clinical_trial_id"
      - "reason_for_rejection"
      - "drug_name"
      - "disease_name"
      - "significantly_better"
      - "non_significantly_better"
      - "non_significantly_worse"
      - "significantly_worse"

preprocessing.int.mapped_clinical_trials_data:
  type:  pandas.CSVDataset
  filepath: ${globals:paths.tmp}/preprocessing_clinical_trials.tsv
  load_args:
    sep: "\t"
  save_args:
    sep: "\t"

preprocessing.raw.ec_medical_team.edges:
  <<: [*_layer_raw, *_medical_kg_sheets_dataset]
  load_args:
    sheet_name: new_edges
    columns: ["Source", "Target", "Label"] 

preprocessing.raw.ec_medical_team.nodes:
  <<: [*_layer_raw, *_medical_kg_sheets_dataset]
  load_args:
    sheet_name: new_nodes
    columns: ["ID", "name", "category", "new_id", "description"]

preprocessing.reporting.ec_medical_team.nodes:
  <<: [*_layer_raw, *_medical_kg_sheets_dataset]
  save_args:
    sheet_name: new_nodes
    write_columns: ["curie", "normalized_curie", "label", "types"]

preprocessing.reporting.ec_medical_team.edges:
  <<: [*_layer_raw, *_medical_kg_sheets_dataset]
  save_args:
    sheet_name: new_edges
    write_columns: ["SourceId", "TargetId"]

preprocessing.reporting.mapped_clinical_trials_data:
  <<: [*_layer_raw, *_medical_clinical_trials_sheet_dataset]
  save_args:
    sheet_name: new_clinical_trial_DD_pairs
    write_columns: ["drug_curie", "disease_curie"]