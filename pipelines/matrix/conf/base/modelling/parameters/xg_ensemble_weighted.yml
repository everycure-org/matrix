modelling.xg_ensemble_weighted:
  _overrides:
    generator:
      _object: matrix.datasets.pair_generator.ReplacementDrugDiseasePairGenerator
      random_state: ${globals:random_state}
      y_label: 2
      n_replacements: 2
      drug_flags:
        - is_drug
        - in_ground_pos
      disease_flags:
        - is_disease

    transformers:
      weighting:
        features: ["source", "target"]
        transformer:
          _object: matrix.pipelines.modelling.transformers.WeightingTransformer
          head_col: source
          tail_col: target
          beta_head_pos: 0.35
          beta_head_neg: 0.8
          beta_tail: 0.0
          head_min: 0.3
          head_max: 3.5
          tail_min: 0.9
          tail_max: 1.1
          pos_budget_scale_head: 2.2
          pos_budget_scale_tail: 1.05
          rho: 0.5
          iters: 120
          tol: 1.0e-3
          clip_factors: true
          normalize: global
          gamma: 0.92
          blend_alpha: null
      flat_source_embedding:
        transformer:
          _object: matrix.pipelines.modelling.transformers.FlatArrayTransformer
          prefix: source_
        features:
          - source_embedding # becomes n columns, named source_0, source_1, etc
      flat_target_embedding:
        transformer:
          _object: matrix.pipelines.modelling.transformers.FlatArrayTransformer
          prefix: target_
        features:
          - target_embedding # becomes n columns, named target_0, target_1, etc

    model_tuning_args:
      tuner:
        _object: matrix.pipelines.modelling.tuning.GaussianSearch
        estimator:
          _object: matrix.pipelines.modelling.model.XGBClassifierWeighted
          n_jobs: 16
          random_state: ${globals:random_state}
          tree_method: hist
          device: cuda
        n_calls: 20
        dimensions:
          - _object: skopt.space.Real
            name: learning_rate
            low: 0.01
            high: 0.5
          - _object: skopt.space.Integer
            name: max_depth
            low: 3
            high: 10
          - _object: skopt.space.Real
            name: lambda
            low: 0
            high: 1
          - _object: skopt.space.Integer
            name: n_estimators
            low: 50
            high: 2500
        scoring:
          _object: matrix.pipelines.modelling.utils.partial_
          func:
            _object: sklearn.metrics.f1_score
          average: macro
        splitter:
          _object: sklearn.model_selection.StratifiedShuffleSplit
          n_splits: 1
          test_size: 0.1
          random_state: ${globals:random_state}
      features: # Features use regex, source_0, source_1, .., target_0, target_1
        - source_+
        - target_+
      target_col_name: y
  # NOTE: This leverages the custom `merge` resolver to override
  # the base options with the override block above.
  model_options: ${merge:${.._model_options},${._overrides}}
