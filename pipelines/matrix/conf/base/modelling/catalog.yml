_pandas_parquet: &_pandas_parquet
  type: pandas.ParquetDataset

_kg_dataset: &_kg_dataset
  type: matrix.datasets.graph.KnowledgeGraphDataset
  load_args:
    engine: pyarrow
    use_nullable_dtypes: True


_neo4j_ds: &_neo4j_ds
  type: matrix.datasets.neo4j.Neo4JSparkDataset
  database: everycure
  url: ${oc.env:NEO4J_HOST}
  credentials: neo4j_credentials
  save_args:
    mode: "overwrite"

modelling.raw.nodes:
  <<: *_neo4j_ds
  load_args:
    query: >  
      MATCH (n:Entity) 
      WHERE n:Drug OR n:Disease
      RETURN 
        n.id AS id, 'biolink:' + labels(n)[1] AS category, 
        n.topological_embedding AS embedding
      

modelling.prm.known_pairs:
  <<: *_pandas_parquet
  filepath: ${globals:paths.prm}/known_pairs

modelling.feat.rtx_kg2:
  <<: *_kg_dataset
  filepath: ${globals:paths.feat}/rtx_kg2_nodes

modelling.model_input.splits:
  <<: *_pandas_parquet
  filepath: ${globals:paths.model_input}/splits

"modelling.{model}.model_input.transformers":
  type: pickle.PickleDataset
  filepath: ${globals:paths.model_input}/{model}/transformers.pickle

"modelling.{model}.model_input.transformed_splits":
  <<: *_pandas_parquet
  filepath: ${globals:paths.model_input}/{model}/transformed_splits

"modelling.{model}.{shard}.model_input.enriched_splits":
  <<: *_pandas_parquet
  filepath: ${globals:paths.model_input}/{model}/{shard}/enriched_splits

"modelling.{model}.{shard}.model_input.transformed_splits":
  <<: *_pandas_parquet
  filepath: ${globals:paths.model_input}/{model}/{shard}/transformed_splits

"modelling.{model}.{shard}.models.model_params":
  type: yaml.YAMLDataset
  filepath: ${globals:paths.models}/{model}/{shard}/model_params.yml

"modelling.{model}.{shard}.models.model":
  type: pickle.PickleDataset
  filepath: ${globals:paths.models}/{model}/{shard}/model.pickle

"modelling.{model}.model_output.predictions":
  <<: *_pandas_parquet
  filepath: ${globals:paths.model_output}/{model}/predictions

"modelling.{model}.{shard}.reporting.tuning_convergence_plot":
  type: matplotlib.MatplotlibWriter
  filepath: ${globals:paths.reporting}/{model}/{shard}/convergence_plot.png

"modelling.{model}.models.model":
  type: pickle.PickleDataset
  filepath: ${globals:paths.models}/{model}/model.pickle

"modelling.{model}.reporting.metrics":
  type: yaml.YAMLDataset
  filepath: ${globals:paths.reporting}/{model}/metrics.yml