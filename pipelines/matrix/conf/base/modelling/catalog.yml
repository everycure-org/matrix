_spark_parquet_ds: &_spark_parquet
  type: matrix_gcp_datasets.gcp.LazySparkDataset
  file_format: parquet
  save_args:
    mode: overwrite

_pandas_parquet: &_pandas_parquet
  type: matrix.datasets.graph.PandasParquetDataset

_kg_dataset: &_kg_dataset
  type: matrix.datasets.graph.KnowledgeGraphDataset
  load_args:
    engine: pyarrow
    use_nullable_dtypes: True

_model_input_ds: &_model_input_ds
  metadata:
    kedro-viz:
      layer: model_input

_model_ds: &_model_ds
  metadata:
    kedro-viz:
      layer: models

_reporting_ds: &_reporting_ds
  metadata:
    kedro-viz:
      layer: reporting

_model_output_ds: &_model_output_ds
  metadata:
    kedro-viz:
      layer: model_output

modelling.int.known_pairs@pandas:
  <<: [*_pandas_parquet, *_model_input_ds]
  filepath: ${globals:paths.modelling}/ground_truth/translator/${globals:data_sources.kgml_xdtd_gt.version}/ground_truth_embeddings

modelling.raw.known_pairs@spark:
  <<: [*_spark_parquet, *_model_input_ds]
  filepath: ${globals:paths.modelling}/ground_truth/translator/${globals:data_sources.kgml_xdtd_gt.version}/ground_truth_pairs

modelling.int.known_pairs@spark:
  <<: [*_spark_parquet, *_model_input_ds]
  filepath: ${globals:paths.modelling}/ground_truth/translator/${globals:data_sources.kgml_xdtd_gt.version}/ground_truth_embeddings

modelling.model_input.drugs_diseases_nodes@spark:
  <<: [*_spark_parquet, *_model_input_ds]
  filepath: ${globals:paths.modelling}/model_input/drugs_diseases_nodes/

modelling.model_input.drugs_diseases_nodes@pandas:
  <<: [*_kg_dataset, *_model_input_ds]
  filepath: ${globals:paths.modelling}/model_input/drugs_diseases_nodes/

modelling.model_input.splits@pandas:
  <<: [*_pandas_parquet, *_model_input_ds]
  filepath: ${globals:paths.modelling}/model_input/splits

modelling.model_input.splits@spark:
  <<: [*_spark_parquet, *_model_input_ds]
  filepath: ${globals:paths.modelling}/model_input/splits

modelling.model_input.temp_splits@pandas:
  <<: [*_pandas_parquet, *_model_input_ds]
  filepath: ${globals:paths.modelling}/model_input/temp_splits

modelling.model_input.temp_splits@spark:
  <<: [*_spark_parquet, *_model_input_ds]
  filepath: ${globals:paths.modelling}/model_input/temp_splits

modelling.reporting.gt_present:
  filepath: ${globals:paths.modelling}/reporting/gt_present_metrics.yml
  type:  yaml.YAMLDataset

"modelling.fold_{fold}.{model_name}.model_input.transformers":
  <<: *_model_input_ds
  type: pickle.PickleDataset
  filepath: ${globals:paths.modelling}/model_input/{model_name}/fold_{fold}/transformers.pickle

"modelling.fold_{fold}.{model_name}.model_input.transformed_splits":
  <<: [*_pandas_parquet, *_model_output_ds]
  filepath: ${globals:paths.modelling}/model_input/{model_name}/fold_{fold}/transformed_splits

"modelling.{shard}.{model_name}.model_input.enriched_splits":
  <<: [*_pandas_parquet, *_model_input_ds]
  filepath: ${globals:paths.modelling}/model_input/{model_name}/{shard}/enriched_splits

"modelling.{shard}.{model_name}.model_input.temp_enriched_splits":
  <<: [*_pandas_parquet, *_model_input_ds]
  filepath: ${globals:paths.modelling}/model_input/{model_name}/{shard}/temp_enriched_splits

"modelling.{shard}.fold_{fold}.{model_name}.model_input.transformed_splits":
  <<: [*_pandas_parquet, *_model_input_ds]
  filepath: ${globals:paths.modelling}/model_input/{model_name}/{shard}/fold_{fold}/transformed_splits

"modelling.{shard}.fold_{fold}.{model_name}.models.model_params":
  <<: *_model_ds
  type: yaml.YAMLDataset
  filepath: ${globals:paths.modelling}/models/{model_name}/{shard}/fold_{fold}/model_params.yml

"modelling.{shard}.fold_{fold}.{model_name}.models.model":
  <<: *_model_ds
  type: pickle.PickleDataset
  filepath: ${globals:paths.modelling}/models/{model_name}/{shard}/fold_{fold}/model.pickle

"modelling.fold_{fold}.{model_name}.model_output.predictions":
  <<: [*_pandas_parquet, *_model_output_ds]
  filepath: ${globals:paths.modelling}/model_output/{model_name}/fold_{fold}/predictions

"modelling.{shard}.fold_{fold}.{model_name}.reporting.tuning_convergence_plot":
  <<: *_reporting_ds
  type: matplotlib.MatplotlibDataset
  filepath: ${globals:paths.tmp}/reporting/{model_name}/{shard}/fold_{fold}/convergence_plot.png

"modelling.fold_{fold}.{model_name}.models.model":
  <<: *_model_ds
  type: pickle.PickleDataset
  filepath: ${globals:paths.modelling}/models/{model_name}/fold_{fold}/model.pickle

"modelling.{model_name}.reporting.metrics":
  <<: *_reporting_ds
  filepath: ${globals:paths.modelling}/reporting/{model_name}/sanity_metrics.yml
  type: yaml.YAMLDataset

"modelling.{model_name}.model_output.combined_predictions":
  <<: [*_pandas_parquet, *_model_output_ds]
  filepath: ${globals:paths.modelling}/model_output/{model_name}/combined_predictions
