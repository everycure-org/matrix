_layer_raw: &_layer_raw
  metadata:
    kedro-viz:
      layer: raw

_layer_int: &_layer_int
  metadata:
    kedro-viz:
      layer: integration

_layer_prm: &_layer_prm
  metadata:
    kedro-viz:
      layer: primary

###################################
########### INPUT DATA ############
###################################

# DEPRECATED: No longer used - PyOxigraph Store is used instead (via mondo_graph)
# disease_list.raw.mondo_owl:
#   type: text.TextDataset
#   <<: *_layer_raw
#   filepath: http://purl.obolibrary.org/obo/mondo.owl

disease_list.raw.mondo_graph:
  type: matrix.datasets.rdf.PyOxiGraphDataset
  <<: *_layer_raw
  filepath: http://purl.obolibrary.org/obo/mondo.owl
  load_args:
    format: xml

disease_list.raw.mondo_sssom:
  type: pandas.CSVDataset
  <<: *_layer_raw
  filepath: http://purl.obolibrary.org/obo/mondo/mappings/mondo.sssom.tsv
  load_args:
    sep: "\t"
    comment: "#"

# @JacquesVergine I only want to download this file, its the start and end point
# Does it need to be mentioned in the pipeline at all?
disease_list.raw.mondo_obsoletion_candidates:
  type: pandas.CSVDataset
  <<: *_layer_raw
  filepath: https://raw.githubusercontent.com/monarch-initiative/mondo/refs/heads/master/src/ontology/reports/mondo_obsoletioncandidates.tsv
  load_args:
    sep: "\t"

disease_list.raw.icd10_cm_codes:
  type: pandas.ExcelDataset
  <<: *_layer_raw
  filepath: https://www.cms.gov/files/document/valid-icd-10-list.xlsx
  load_args:
    sheet_name: 0

#############################################
########### Intermediate Outputs ############
#############################################

#TODO: Do intermediate outputs need to be saved to disk? Or can they be kept in memory only?

disease_list.int.mondo_preprocessed:
  type: matrix.datasets.rdf.PyOxiGraphDataset
  <<: *_layer_int
  filepath: ${globals:paths.tmp}/disease_list/mondo_preprocessed.owl
  save_args:
    format: xml

# DEPRECATED: mondo_labels is no longer persisted (handled in-memory in merged node)
# disease_list.int.mondo_labels:
#   type: pandas.CSVDataset
#   <<: *_layer_int
#   filepath: ${globals:paths.tmp}/disease_list/mondo_labels.tsv

disease_list.int.billable_icd10_codes:
  type: pandas.CSVDataset
  <<: *_layer_int
  filepath: ${globals:paths.tmp}/disease_list/icd10_cm_billable_template.tsv
  load_args:
    sep: "\t"
  save_args:
    sep: "\t"
    index: false

# DEPRECATED: subtypes_template is no longer persisted (handled in-memory in merged node)
# disease_list.int.subtypes_template:
#   type: pandas.CSVDataset
#   <<: *_layer_int
#   filepath: ${globals:paths.tmp}/disease_list/subtypes_template.tsv

disease_list.int.subtype_counts:
  type: pandas.CSVDataset
  <<: *_layer_int
  filepath: ${globals:paths.tmp}/disease_list/subtype_counts.tsv
  load_args:
    sep: "\t"
  save_args:
    sep: "\t"
    index: false

disease_list.int.mondo_metrics:
  type: pandas.CSVDataset
  <<: *_layer_int
  filepath: ${globals:paths.tmp}/disease_list/mondo_metrics.tsv
  load_args:
    sep: "\t"
  save_args:
    sep: "\t"
    index: false

disease_list.int.disease_list_raw:
  type: pandas.CSVDataset
  <<: *_layer_int
  filepath: ${globals:paths.tmp}/disease_list/disease_list_raw.tsv
  load_args:
    sep: "\t"
  save_args:
    sep: "\t"
    index: false

#############################################
########### Final Outputs ###################
#############################################

# The final disease list
disease_list.prm.disease_list:
  type: pandas.CSVDataset
  <<: *_layer_prm
  filepath: ${globals:paths.release}/disease_list.tsv
  save_args:
    sep: "\t"
    index: false
  load_args:
    sep: "\t"

# A file containing basic metadata about the disease list run, in particular
# which MONDO version was used to generate the disease list
disease_list.prm.mondo_metadata:
  type: pandas.CSVDataset
  <<: *_layer_prm
  filepath: ${globals:paths.release}/mondo-metadata.tsv
  save_args:
    sep: "\t"
    index: false

# A full list of all obsoleted MONDO terms, along with their obsoletion reason 
# and replacement term (if any)
disease_list.prm.mondo_obsoletes:
  type: pandas.CSVDataset
  <<: *_layer_prm
  filepath: ${globals:paths.release}/mondo-obsoletes.tsv
  save_args:
    sep: "\t"
    index: false

# Obsoletion candidates are diseases that are marked for obsoletion in MONDO
# These are needed so we can define a strategy on how to curate them in our d2d reviews
# TODO: the weird thing about this one is that it is only downloaded, but not used 
# in this specific pipeline - Jacques need to check where/how it is used
disease_list.prm.mondo_obsoletion_candidates:
  type: pandas.CSVDataset
  <<: *_layer_prm
  filepath: ${globals:paths.release}/mondo-obsoletion_candidates.tsv
  save_args:
    sep: "\t"
    index: false
