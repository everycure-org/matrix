_layer_raw: &_layer_raw
  metadata:
    kedro-viz:
      layer: raw

_layer_int: &_layer_int
  metadata:
    kedro-viz:
      layer: integration

_layer_prm: &_layer_prm
  metadata:
    kedro-viz:
      layer: primary

###################################
########### INPUT DATA ############
###################################

disease_list.raw.mondo_owl:
  type: text.TextDataset
  <<: *_layer_raw
  filepath: http://purl.obolibrary.org/obo/mondo.owl

disease_list.raw.mondo_sssom:
  type: pandas.CSVDataset
  <<: *_layer_raw
  filepath: http://purl.obolibrary.org/obo/mondo/mappings/mondo.sssom.tsv
  load_args:
    sep: "\t"
    comment: "#"

disease_list.raw.mondo_obsoletion_candidates:
  type: pandas.CSVDataset
  <<: *_layer_raw
  filepath: https://raw.githubusercontent.com/monarch-initiative/mondo/refs/heads/master/src/ontology/reports/mondo_obsoletioncandidates.tsv
  load_args:
    sep: "\t"

disease_list.raw.icd10_cm_codes:
  type: pandas.ExcelDataset
  <<: *_layer_raw
  filepath: https://www.cms.gov/files/document/valid-icd-10-list.xlsx
  load_args:
    sheet_name: 0

#############################################
########### Manually curated inputs #########
#############################################

disease_list.raw.grouping_diseases_template:
  type: pandas.CSVDataset
  <<: *_layer_raw
  filepath: https://raw.githubusercontent.com/everycure-org/matrix-disease-list/refs/heads/main/src/grouping-diseases.robot.tsv
  load_args:
    sep: "\t"

#############################################
########### Intermediate Outputs ############
#############################################

#TODO: Do intermediate outputs need to be saved to disk? Or can they be kept in memory only?

disease_list.int.mondo_preprocessed:
  type: text.TextDataset
  <<: *_layer_raw
  filepath: ${globals:paths.tmp}/disease_list/mondo_preprocessed.owl

disease_list.int.mondo_labels:
  type: pandas.CSVDataset
  <<: *_layer_int
  filepath: ${globals:paths.tmp}/disease_list/mondo_labels.tsv
  load_args:
    sep: "\t"
  save_args:
    sep: "\t"

disease_list.int.billable_icd10_template:
  type: pandas.CSVDataset
  <<: *_layer_int
  filepath: ${globals:paths.tmp}/disease_list/icd10_cm_billable_template.tsv
  load_args:
    sep: "\t"
  save_args:
    sep: "\t"
    index: false

disease_list.int.subtypes_template:
  type: pandas.CSVDataset
  <<: *_layer_int
  filepath: ${globals:paths.tmp}/disease_list/subtypes_template.tsv
  load_args:
    sep: "\t"
  save_args:
    sep: "\t"
    index: false

disease_list.int.mondo_metrics:
  type: pandas.CSVDataset
  <<: *_layer_int
  filepath: ${globals:paths.tmp}/disease_list/mondo_metrics.tsv
  load_args:
    sep: "\t"
  save_args:
    sep: "\t"
    index: false

disease_list.int.disease_list_raw:
  type: pandas.CSVDataset
  <<: *_layer_int
  filepath: ${globals:paths.tmp}/disease_list/disease_list_raw.tsv
  load_args:
    sep: "\t"
  save_args:
    sep: "\t"
    index: false

#############################################
########### Final Outputs ###################
#############################################

# The final disease list
disease_list.int.disease_list:
  type: pandas.CSVDataset
  <<: *_layer_int
  filepath: ${globals:paths.release}/disease_list.tsv
  save_args:
    sep: "\t"
    index: false

# A file containing basic metadata about the disease list run, in particular
# which MONDO version was used to generate the disease list
disease_list.prm.mondo_metadata:
  type: pandas.CSVDataset
  <<: *_layer_prm
  filepath: ${globals:paths.release}/mondo-metadata.tsv
  save_args:
    sep: "\t"
    index: false

# A full list of all obsoleted MONDO terms, along with their obsoletion reason 
# and replacement term (if any)
disease_list.prm.mondo_obsoletes:
  type: pandas.CSVDataset
  <<: *_layer_prm
  filepath: ${globals:paths.release}/mondo-obsoletes.tsv
  save_args:
    sep: "\t"
    index: false

# Obsoletion candidates are diseases that are marked for obsoletion in MONDO
# These are needed so we can define a strategy on how to curate them in our d2d reviews
# TODO: the weird thing about this one is that it is only downloaded, but not used 
# in this specific pipeline - Jacques need to check where/how it is used
disease_list.prm.mondo_obsoletion_candidates:
  type: pandas.CSVDataset
  <<: *_layer_prm
  filepath: ${globals:paths.release}/mondo-obsoletion_candidates.tsv
  save_args:
    sep: "\t"
    index: false
