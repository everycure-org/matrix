run_comparison:

  input_data:
    # Option to apply data harmonization to consistent drug list, disease list,
    # training set, and test set across all models. If False, the input data
    # must be consistent to begin with, otherwise an error will be raised.
    apply_harmonization: True

    # Specify the matrix predictions you would like to evaluate here.
    # Known positive and negative drug-disease pairs used in training MUST NOT
    # be included in the predictions dataframe.
    # Brace expansion patterns may be used to collect all folds.
    input_paths:
      # Expected format:
      # ----------------
      # - name: <Name of model>
      #   file_path_list: <List of filepaths for all folds>
      #     -  e.g. "dir/fold_{0,1,2}/preds" or "dir/fold_{0..2}/preds"
      #   file_format: "parquet" or "csv"
      #   score_col_name: <Name of column containing drug-disease pair scores>

      - name: xg_ensemble_untransformed
        fold_paths_list: 
          - "gs://mtrx-us-central1-hub-dev-storage/kedro/data/releases/v0.11.2/runs/auto-kg-release-v0-11-2-39910042/datasets/matrix_generation/model_output/fold_{0..4}/matrix_predictions"
        file_format: "parquet"
        score_col_name: "treat score"

      - name: xg_ensemble_transformed
        fold_paths_list:
          - "gs://mtrx-us-central1-hub-dev-storage/kedro/data/releases/v0.11.2/runs/auto-kg-release-v0-11-2-39910042/datasets/matrix_transformations/fold_{0..4}/transformed_matrix"
        file_format: "parquet"
        score_col_name: "transformed_treat_score"

  # Configuration for the evaluations to perform. Usually it is not necessary to modify these.
  available_ground_truth_cols: # These columns are expected to be present on the predictions dataframes for all models and folds.
    - &is_known_positive_col "is_known_positive"
    - &is_known_negative_col "is_known_negative"
    - &off_label_col "off_label"

  evaluations:
    ground_truth_recall_at_n: 
      &ground_truth_recall_at_n
      _object: matrix.pipelines.run_comparison.evaluations.FullMatrixRecallAtN
      ground_truth_col: *is_known_positive_col
      n_max: 100000
      perform_sort: True
      title: "Recall@n (standard ground truth)"

    ground_truth_recall_at_n_bootstrap:
      <<: *ground_truth_recall_at_n
      _object: matrix.pipelines.run_comparison.evaluations.FullMatrixRecallAtNBootstrap
      N_bootstraps: 100

    negative_recall_at_n: &negative_recall_at_n
      _object: matrix.pipelines.run_comparison.evaluations.FullMatrixRecallAtN
      ground_truth_col: *is_known_negative_col
      n_max: 1000000
      perform_sort: True
      title: "Recall@n (negative ground truth) - lower is better"
      force_full_y_axis: False

    negative_recall_at_n_bootstrap:
      <<: *negative_recall_at_n
      _object: matrix.pipelines.run_comparison.evaluations.FullMatrixRecallAtNBootstrap
      N_bootstraps: 100

    off_label_recall_at_n: &off_label_recall_at_n
      _object: matrix.pipelines.run_comparison.evaluations.FullMatrixRecallAtN
      ground_truth_col: *off_label_col
      n_max: 100000
      perform_sort: True
      title: "Recall@n (off-label)"

    off_label_recall_at_n_bootstrap:
      <<: *off_label_recall_at_n
      _object: matrix.pipelines.run_comparison.evaluations.FullMatrixRecallAtNBootstrap
      N_bootstraps: 100

    disease_specific_hit_at_k:
      &disease_specific_hit_at_k
      _object: matrix.pipelines.run_comparison.evaluations.SpecificHitAtK
      ground_truth_col: *is_known_positive_col
      other_pos_cols:
        - *off_label_col
      k_max: 200
      title: "Disease-specific Hit@k (standard ground truth)"
      specific_col: "target"
      force_full_y_axis: True

    disease_specific_hit_at_k_bootstrap:
      <<: *disease_specific_hit_at_k
      _object: matrix.pipelines.run_comparison.evaluations.SpecificHitAtKBootstrap ## TODO: Implement 
      N_bootstraps: 100

    disease_specific_hit_at_k_off_label:
      &disease_specific_hit_at_k_off_label
      _object: matrix.pipelines.run_comparison.evaluations.SpecificHitAtK
      ground_truth_col: *off_label_col
      other_pos_cols:
        - *is_known_positive_col
      k_max: 200
      title: "Disease-specific Hit@k (off-label)"
      specific_col: "target"
      force_full_y_axis: True

    disease_specific_hit_at_k_off_label_bootstrap:
      <<: *disease_specific_hit_at_k_off_label
      _object: matrix.pipelines.run_comparison.evaluations.SpecificHitAtKBootstrap ## TODO: Implement 
      N_bootstraps: 100

    drug_entropy_at_n:
      _object: matrix.pipelines.run_comparison.evaluations.EntropyAtN
      count_col: "source"
      n_max: 100000
      perform_sort: True
      title: "Drug-Entropy@n"
      force_full_y_axis: True

    disease_entropy_at_n:
      _object: matrix.pipelines.run_comparison.evaluations.EntropyAtN
      count_col: "target"
      n_max: 100000
      perform_sort: True
      title: "Disease-Entropy@n"
      force_full_y_axis: True

    commonality_at_n:
      _object: matrix.pipelines.run_comparison.evaluations.CommonalityAtN
      n_max: 1000000
      perform_sort: True
      title: "Commonality@n"
      force_full_y_axis: True
      num_n_values: 1000