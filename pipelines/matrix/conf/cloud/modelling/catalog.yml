_reporting_ds: &_reporting_ds
  metadata:
    kedro-viz:
      layer: reporting

# NOTE: Saving an artifact, saving both locally and in MLFlow
# https://kedro-mlflow.readthedocs.io/en/stable/source/04_experimentation_tracking/03_version_datasets.html#how-to-version-data-in-a-kedro-project
"modelling.{shard}.fold_{fold}.reporting.tuning_convergence_plot":
  type: kedro_mlflow.io.artifacts.MlflowArtifactDataset
  artifact_path: "{shard}.fold_{fold}"
  dataset:
    <<: *_reporting_ds
    type: matplotlib.MatplotlibDataset
    filepath: ${globals:paths.tmp}/{shard}/fold_{fold}/convergence_plot.png

# NOTE: Saving a metric, more elaborate strategies possible, e.g., MlflowMetricHistoryDataset
# https://kedro-mlflow.readthedocs.io/en/stable/source/04_experimentation_tracking/05_version_metrics.html#saving-a-single-float-as-a-metric-with-mlflowmetricdataset
"modelling.{shard}.fold_{fold}.reporting.metrics":
  # FUTURE: The Kedro MLFlow plugin does not support metadata,
  # add in when provided by the plugin.
  # <<: *_reporting_ds
  type: matrix.datasets.mlflow.MlflowMetricsDataset

"modelling.{shard}.fold_{fold}.reporting.metrics_aggregated":
  type: matrix.datasets.mlflow.MlflowMetricsDataset

modelling.reporting.gt_present:
  type: matrix.datasets.mlflow.MlflowMetricsDataset
  key_prefix: "gt_present"

# # ──────────────────────────────────────────────────────────────
# # Save a Matplotlib figure directly to Google Cloud Storage
# # ──────────────────────────────────────────────────────────────
# weight_plot:
#   type: kedro_datasets.matplotlib.MatplotlibDataset
#   filepath: >
#     gs://mtrx-us-central1-hub-dev-storage/kedro/data/tests/v0.4.5/datasets/reports/figures/weights/{node_name}.png
#   # backend: "Agg" # non-GUI backend (safe in headless pods)
#   # fs_args:
#   # project: mtrx-us-central1-hub-dev          # GCP project ID  (needed by gcsfs)
#   # credentials: gcs_creds
#   # save_args:                    # any plt.savefig(**kwargs)
#   # dpi: 110
#   # bbox_inches: tight

weight_diagnostic_plot:
  type: kedro_mlflow.io.artifacts.MlflowArtifactDataset
  artifact_path: "weights"
  dataset:
    type: kedro_datasets.matplotlib.MatplotlibDataset
    backend: "Agg"
    filepath: ${globals:paths.tmp}/weights/{node_name}.png
