_bigquery_ds: &_bigquery_ds
  type: matrix.datasets.gcp.SparkDatasetWithBQExternalTable
  project_id: ${oc.env:RUNTIME_GCP_PROJECT_ID}
  dataset: release_${globals:versions.release}
  file_format: parquet
  save_args:
    mode: overwrite
    labels:
      git_sha: ${globals:git_sha}

# -------------------------------------------------------------------------
# Datasets
# -------------------------------------------------------------------------

# Overwriting the base catalog to use the bigquery datasets

#TODO how do we make this lke the integration catalog that depends on {source} rather than hardcoding the name
# Ingested RTX KG2 nodes/edges
ingestion.int.rtx_kg2.nodes:
  <<: *_bigquery_ds
  filepath: ${globals:paths.ingestion}/int/rtx_kg2/${globals:data_sources.rtx_kg2.version}/nodes
  table: rtx_kg2_nodes_ingested_${globals:data_sources.rtx_kg2.version}

ingestion.int.rtx_kg2.edges:
  <<: *_bigquery_ds
  filepath: ${globals:paths.ingestion}/int/rtx_kg2/${globals:data_sources.rtx_kg2.version}/edges
  table: rtx_kg2_edges_ingested_${globals:data_sources.rtx_kg2.version}

# Ingested Robokop nodes/edges
ingestion.int.robokop.nodes:
  <<: *_bigquery_ds
  filepath: ${globals:paths.ingestion}/int/robokop/${globals:data_sources.robokop.version}/nodes
  table: robokop_nodes_ingested_${globals:data_sources.robokop.version}

ingestion.int.robokop.edges:
  <<: *_bigquery_ds
  filepath: ${globals:paths.ingestion}/int/robokop/${globals:data_sources.robokop.version}/edges
  table: robokop_edges_ingested_${globals:data_sources.robokop.version}

# Ingested Spoke nodes/edges
ingestion.int.spoke.nodes:
  <<: *_bigquery_ds
  filepath: ${globals:paths.ingestion}/int/spoke/${globals:data_sources.spoke.version}/nodes
  table: spoke_nodes_ingested_${globals:data_sources.spoke.version}

ingestion.int.spoke.edges:
  <<: *_bigquery_ds
  filepath: ${globals:paths.ingestion}/int/spoke/${globals:data_sources.spoke.version}/edges
  table: spoke_edges_ingested_${globals:data_sources.spoke.version}

# Ingested Embiology nodes/edges
ingestion.int.embiology.nodes:
  <<: *_bigquery_ds
  filepath: ${globals:paths.ingestion}/int/embiology/${globals:data_sources.embiology.version}/nodes
  table: embiology_nodes_ingested

ingestion.int.embiology.edges:
  <<: *_bigquery_ds
  filepath: ${globals:paths.ingestion}/int/embiology/${globals:data_sources.embiology.version}/edges
  table: embiology_edges_ingested_${globals:data_sources.embiology.version}