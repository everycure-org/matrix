apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: actions-runner-controller
  namespace: argocd
spec:
  destination:
    namespace: actions-runner-system
    server: {{ .Values.spec.destination.server }}
  project: default
  source:
    path: {{ .Values.spec.source.repoPath }}/actions-runner-controller
    repoURL: {{ .Values.spec.source.repoURL }}
    targetRevision: {{ .Values.spec.source.targetRevision }}
    helm:
      parameters:
        - name: replicaCount
          value: 1
        - name: nodeSelector.workload-type
          value: management
        - name: resources.limits.cpu
          value: 500m
        - name: resources.limits.memory
          value: 512Mi
        - name: tolerations[0].key
          value: workload-type
        - name: tolerations[0].operator
          value: Equal
        - name: tolerations[0].value
          value: management
        - name: podSecurityContext.runAsNonRoot
          value: "true"
        - name: podSecurityContext.runAsUser
          value: "1001"
        - name: podSecurityContext.runAsGroup
          value: "1001"
        - name: podSecurityContext.fsGroup
          value: "1001"
        - name: securityContext.runAsNonRoot
          value: "true"
        - name: securityContext.runAsUser
          value: "1001"
        - name: securityContext.runAsGroup
          value: "1001"
        - name: securityContext.fsGroup
          value: "1001"
        - name: podLabels.cost-center
          value: "infrastructure-management"
        - name: podLabels.workload-category
          value: "platform-services"
        - name: podLabels.service-tier
          value: "management"
        - name: podLabels.billing-category
          value: "infrastructure"
        - name: podLabels.component
          value: "actions-runner-controller"
        - name: podLabels.team
          value: "platform"
        - name: podLabels.environment
          value: "production"
        - name: podLabels.maintenance-window
          value: "off-hours"
        - name: podAnnotations.cluster-autoscaler.kubernetes.io/safe-to-evict
          value: "true"
        - name: rbac.create
          value: "true"
  syncPolicy:
    syncOptions:
      - CreateNamespace=true
    automated:
      prune: true
      allowEmpty: true
