kube-prometheus-stack:
  prometheus:
    prometheusSpec:
      storageSpec:
        volumeClaimTemplate:
          spec:
            storageClassName: standard
            accessModes: ["ReadWriteOnce"]
            resources:
              requests:
                storage: 25Gi
      additionalServiceMonitors:
        - name: argo-workflows
          selector:
            matchLabels:
              app.kubernetes.io/name: argo-workflows-server
          namespaceSelector:
            matchNames:
              - argo-workflows 
          endpoints:
            - port: metrics
              path: /metrics
        - name: argo-workflows-controller
          selector:
            matchLabels:
              app.kubernetes.io/name: argo-workflows-workflow-controller
          namespaceSelector:
            matchNames:
              - argo-workflows  
          endpoints:
            - port: metrics
              path: /metrics
      service:
        annotations:
          cloud.google.com/backend-config: '{"default": "prometheus-backend-config"}'
      
      # Add BackendConfig as an additional resource
      additionalResources:
        - apiVersion: cloud.google.com/v1
          kind: BackendConfig
          metadata:
            name: prometheus-backend-config
          spec:
            healthCheck:
              requestPath: /healthz
              port: 9090
              type: HTTP
              checkIntervalSec: 10
              timeoutSec: 1
              healthyThreshold: 1
              unhealthyThreshold: 3
  grafana:
    sidecar:
      dashboards:
        enabled: true
      defaultFolderName: "General"
      label: grafana_dashboard
      labelValue: "1"
      folderAnnotation: grafana_folder
      searchNamespace: ALL
      provider:
        foldersFromFilesStructure: true
      service:
        annotations:
          cloud.google.com/backend-config: '{"default": "grafana-backend-config"}'
      
      # Add BackendConfig as an additional resource
      additionalResources:
        - apiVersion: cloud.google.com/v1
          kind: BackendConfig
          metadata:
            name: grafana-backend-config
          spec:
            healthCheck:
              requestPath: /api/health
              port: 3000
              type: HTTP
              checkIntervalSec: 10
              timeoutSec: 1
              healthyThreshold: 1
              unhealthyThreshold: 3