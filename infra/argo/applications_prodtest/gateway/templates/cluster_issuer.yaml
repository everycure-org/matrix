---
apiVersion: cert-manager.io/v1
kind: ClusterIssuer
metadata:
  name: letsencrypt-prod
spec:
  acme:
    email: gcp-admins@everycure.org  # Replace with your email
    server: https://acme-v02.api.letsencrypt.org/directory
    privateKeySecretRef:
      name: letsencrypt-account-key
    solvers:
      # HTTP01 solver configuration for simple non wildcard certificate validation
      - http01:
          gatewayHTTPRoute:
            parentRefs:
              - name: external-http  # Ensure this matches the name of your Gateway resource
                group: gateway.networking.k8s.io
                namespace: {{ .Values.namespace }} 
                kind: Gateway 
      # DNS01 solver configuration for wildcard certificate validation
      - selector:
          dnsNames:
          - "neo4j.{{ .Values.source.environment }}.everycure.org"
          - "*.platform.{{ .Values.source.environment }}.everycure.org"
        dns01:
          cloudDNS:
            project: {{ .Values.source.project_id }}  # This should match your Google Cloud project ID